{% extends "base.html" %}

{% block title %}Learning Library{% endblock %}

{% block content %}
<!-- Hero Section (Above the Fold) -->
<section class="hero">
    <!-- Search Bar -->
    <div class="hero-search">
        <input type="text" id="search-input" placeholder="Search videos, papers, podcasts..." autocomplete="off">
        <button id="search-btn">Search</button>
        <button id="clear-search" style="display: none;">Clear</button>
    </div>

    <!-- AI Chat Input -->
    <div class="hero-chat">
        <input type="text" id="chat-input" placeholder="Ask AI: What should I learn about transformers?">
        <button id="chat-btn">Ask</button>
    </div>

    <!-- Docent Desk -->
    <div class="docent-desk">
        <button id="docent-btn" class="docent-icon" title="Help &amp; API Info">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            <span>docent desk</span>
        </button>
    </div>
</section>

<!-- Search Results (Hidden by default) -->
<div id="search-results" class="search-results" style="display: none;"></div>

<!-- Chat Messages (Hidden by default, expands when chat is used) -->
<div id="chat-container" class="chat-container-expandable" style="display: none;">
    <div id="chat-messages" class="chat-messages"></div>
</div>

<!-- Docent Modal -->
<div id="docent-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <button class="modal-close" id="docent-close">&times;</button>
        <h2>Welcome to the Learning Library</h2>

        <div class="docent-section">
            <h3>For Humans</h3>
            <ul>
                <li><strong>Search</strong> - Find content by keyword across {{ total_entries }} items</li>
                <li><strong>AI Chat</strong> - Ask questions, get personalized recommendations</li>
                <li><strong>Browse</strong> - Scroll down to explore by topic, format, or channel</li>
            </ul>
        </div>

        <div class="docent-section">
            <h3>For AI Agents</h3>
            <ul>
                <li><a href="/library.json">library.json</a> - Full index ({{ total_entries }} items)</li>
                <li><a href="/llms.txt">llms.txt</a> - Agent discovery guide</li>
                <li><a href="/.well-known/ai.json">ai.json</a> - API capabilities</li>
                <li><a href="/sitemap.xml">sitemap.xml</a> - All pages</li>
            </ul>
        </div>

        <div class="docent-section">
            <h3>API Access</h3>
            <p>REST API: <code>https://youtube-library-docent.dlkarpay.workers.dev/api/</code></p>
            <ul class="api-endpoints">
                <li><code>GET /api/search?q=query</code></li>
                <li><code>GET /api/recommend?topic=ai-ml</code></li>
                <li><code>GET /api/whats-new?days=7</code></li>
                <li><code>POST /api/chat</code></li>
            </ul>
        </div>

        <div class="docent-section">
            <h3>Content</h3>
            <p>{{ video_count }} videos • {{ paper_count }} papers • {{ podcast_count }} podcasts • {{ blog_count }} blogs</p>
        </div>
    </div>
</div>

<!-- Below the Fold: Browse Interface -->
<div id="library-content">
    <div class="filters">
        <!-- Domain Filter Toggle -->
        <div class="filter-group">
            <h3>Domain
                <nav class="domain-filter" aria-label="Domain filter">
                    <a href="#" data-domain="all" class="active">All</a>
                    <a href="#" data-domain="computer-science">CS</a>
                    <a href="#" data-domain="law">Law</a>
                </nav>
            </h3>
        </div>

        <div class="filter-group">
            <h3>Topics</h3>
            <div class="tags">
                {% for topic in topics %}
                <a href="topics/{{ topic }}.html" class="tag">{{ topic }}</a>
                {% endfor %}
            </div>
        </div>

        <div class="filter-group">
            <h3>Format</h3>
            <div class="tags">
                {% for fmt in formats %}
                <a href="#" class="tag" data-filter="format" data-value="{{ fmt }}">{{ fmt }}</a>
                {% endfor %}
            </div>
        </div>

        <div class="filter-group">
            <h3>Difficulty</h3>
            <div class="tags">
                {% for diff in difficulties %}
                <a href="#" class="tag" data-filter="difficulty" data-value="{{ diff }}">{{ diff }}</a>
                {% endfor %}
            </div>
        </div>

        {% if channels %}
        <div class="filter-group">
            <h3>Channels</h3>
            <div class="tags">
                {% for channel in channels %}
                <a href="channels/{{ channel.slug }}.html" class="tag">{{ channel.name }}</a>
                {% endfor %}
                {% if channels|length >= 10 %}
                <a href="channels/index.html" class="tag" style="background: var(--accent);">All channels...</a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>

    <div class="entries">
        {% for entry in entries %}
        <article class="entry-card domain-{{ entry.domain|default('computer-science') }} {% if entry.content_type == 'paper' %}paper-card{% elif entry.content_type == 'podcast' %}podcast-card{% elif entry.content_type == 'blog' %}blog-card{% elif entry.content_type == 'legal' %}legal-card{% elif entry.content_type == 'law-journal' %}journal-card{% endif %}"
                 data-topics="{{ entry.facets.topics|join(',') }}"
                 data-format="{{ entry.facets.format }}"
                 data-difficulty="{{ entry.facets.difficulty }}"
                 data-type="{{ entry.content_type|default('video') }}"
                 data-domain="{{ entry.domain|default('computer-science') }}">
            <div class="entry-badges">
                {% if entry.content_type == 'paper' %}
                <span class="content-type-badge paper-badge">Paper</span>
                {% elif entry.content_type == 'podcast' %}
                <span class="content-type-badge podcast-badge">Podcast</span>
                {% elif entry.content_type == 'blog' %}
                <span class="content-type-badge blog-badge">Blog</span>
                {% elif entry.content_type == 'legal' %}
                <span class="content-type-badge legal-badge">Legal</span>
                {% elif entry.content_type == 'law-journal' %}
                <span class="content-type-badge journal-badge">Journal</span>
                {% endif %}
                <span class="domain-badge {{ entry.domain|default('computer-science') }}">{{ entry.domain|default('CS')|replace('computer-science', 'CS')|replace('law', 'Law') }}</span>
            </div>
            {% if entry.content_type == 'paper' %}
            <h2><a href="papers/{{ entry._filename }}.html">{{ entry.title }}</a></h2>
            {% elif entry.content_type == 'podcast' %}
            <h2><a href="podcasts/{{ entry._filename }}.html">{{ entry.title }}</a></h2>
            {% elif entry.content_type == 'blog' %}
            <h2><a href="blogs/{{ entry._filename }}.html">{{ entry.title }}</a></h2>
            {% elif entry.content_type == 'legal' %}
            <h2><a href="legal/{{ entry._filename }}.html">{{ entry.title }}</a></h2>
            {% elif entry.content_type == 'law-journal' %}
            <h2><a href="journals/{{ entry._filename }}.html">{{ entry.title }}</a></h2>
            {% else %}
            <h2><a href="transcripts/{{ entry._filename }}.html">{{ entry.title }}</a></h2>
            {% endif %}
            <div class="entry-meta">
                {% if entry.duration_seconds %}
                <span class="duration">{{ entry.duration_seconds|format_duration }}</span>
                •
                {% endif %}
                {% if entry.upvotes %}
                <span class="upvotes">▲ {{ entry.upvotes }}</span>
                •
                {% endif %}
                <span class="topic">{{ entry.facets.topics|join(', ') }}</span>
                •
                <span class="difficulty">{{ entry.facets.difficulty }}</span>
                •
                <span class="date">{{ entry.added_date }}</span>
            </div>
            {% if entry.summary %}
            <div class="entry-summary">
                <ul>
                    {% for point in entry.summary[:3] %}
                    <li>{{ point }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </article>
        {% endfor %}
    </div>
</div>

<script src="assets/library.js"></script>
{% endblock %}
